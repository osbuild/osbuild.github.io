<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-hosted/architecture/image-builder-workers" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.6.3">
<title data-rh="true">Image Builder Workers | Image Builder</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://osbuild.org/docs/hosted/architecture/image-builder-workers/"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Image Builder Workers | Image Builder"><meta data-rh="true" name="description" content="Service Description"><meta data-rh="true" property="og:description" content="Service Description"><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://osbuild.org/docs/hosted/architecture/image-builder-workers/"><link data-rh="true" rel="alternate" href="https://osbuild.org/docs/hosted/architecture/image-builder-workers/" hreflang="en"><link data-rh="true" rel="alternate" href="https://osbuild.org/docs/hosted/architecture/image-builder-workers/" hreflang="x-default"><link rel="stylesheet" href="/assets/css/styles.ca270162.css">
<script src="/assets/js/runtime~main.6114353e.js" defer="defer"></script>
<script src="/assets/js/main.a6dc5c18.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard" data-theme="light">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const n=new URLSearchParams(window.location.search).entries();for(var[t,e]of n)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.svg" alt="osbuild logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/img/logo_dark.svg" alt="osbuild logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">Image Builder</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/hosted/architecture/">Hosted</a><a class="navbar__item navbar__link" href="/docs/on-premises/overview/">On Premises</a><a class="navbar__item navbar__link" href="/docs/bootc/">Bootc</a><a class="navbar__item navbar__link" href="/docs/user-guide/introduction/">User Guide</a><a class="navbar__item navbar__link" href="/docs/developer-guide/index/">Developer Guide</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/osbuild/" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite" aria-pressed="false"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"><div class="dsla-search-wrapper"><div class="dsla-search-field" data-tags="default,docs-default-current"></div></div></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" href="/docs/hosted/architecture/">Architecture</a><button aria-label="Collapse sidebar category &#x27;Architecture&#x27;" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/hosted/architecture/image-builder-crc/">Image Builder Backend</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/hosted/architecture/image-builder-composer/">Image Builder Composer</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/hosted/architecture/image-builder-workers/">Image Builder Workers</a></li></ul></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/hosted/fedora-console/">Fedora service</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/hosted/image-builder-koji/">Image Builder Koji integration</a></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/docs/hosted/architecture/"><span itemprop="name">Architecture</span></a><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Image Builder Workers</span><meta itemprop="position" content="2"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Image Builder Workers</h1></header>
<h1>Image Builder Workers Architecture Document</h1>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="service-description">Service Description<a href="#service-description" class="hash-link" aria-label="Direct link to Service Description" title="Direct link to Service Description">​</a></h2>
<p>The <code>workers</code> are a fleet of (for now) amazon EC2 instances, responsible for requesting pending jobs
from the composer-worker API in AOC, perform jobs as instructed and report back the results. The
kinds of jobs are:</p>
<ul>
<li>determining build instructions for future image builds</li>
<li>building images</li>
<li>uploading images to their destination</li>
<li>registering images in their target platform</li>
</ul>
<p>Workers are stateless, apart from their caches, and hence trivially restartable. To build images
workers need to be running in a VM with kernel access, rather than in a container, and in order
to upload the results the workers need the right credentials for each of the possible targets. In
order to request new jobs, the workers need to be issued with RH credentials.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="technology-stack">Technology Stack<a href="#technology-stack" class="hash-link" aria-label="Direct link to Technology Stack" title="Direct link to Technology Stack">​</a></h2>
<p>The service is written in Golang, and the list of vendored dependencies can be found in
<a href="https://github.com/osbuild/osbuild-composer/blob/main/go.mod" target="_blank" rel="noopener noreferrer">go.mod</a>. The underlying tool is written
in python3.</p>
<p>Both the service and underlying tool are built as RPMs and installed into AMIs. Their dependencies are
specified in their respective .spec files:</p>
<ul>
<li><a href="https://github.com/osbuild/osbuild/blob/main/osbuild.spec" target="_blank" rel="noopener noreferrer">https://github.com/osbuild/osbuild/blob/main/osbuild.spec</a></li>
<li><a href="https://github.com/osbuild/osbuild-composer/blob/main/osbuild-composer.spec" target="_blank" rel="noopener noreferrer">https://github.com/osbuild/osbuild-composer/blob/main/osbuild-composer.spec</a></li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="components">Components<a href="#components" class="hash-link" aria-label="Direct link to Components" title="Direct link to Components">​</a></h2>
<p>The service consists of a fleet of workers. If no workers are available, no jobs will be built until
workers are again available. Nothing is lost as jobs will stay in the queue, but everything will
simply stall.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="routes">Routes<a href="#routes" class="hash-link" aria-label="Direct link to Routes" title="Direct link to Routes">​</a></h2>
<p>The workers expose no routes.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="dependencies">Dependencies<a href="#dependencies" class="hash-link" aria-label="Direct link to Dependencies" title="Direct link to Dependencies">​</a></h2>
<p>The workers have the following internal and external dependencies.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="internal">Internal<a href="#internal" class="hash-link" aria-label="Direct link to Internal" title="Direct link to Internal">​</a></h3>
<ul>
<li>Red Hat SSO for authentication. Without this, the worker cannot request new jobs.</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="external">External<a href="#external" class="hash-link" aria-label="Direct link to External" title="Direct link to External">​</a></h3>
<ul>
<li>EC2. Without this the workers cannot run.</li>
<li>EC2, GCP and Azure to upload the respective images. Without this image upload will fail.</li>
<li>S3 to upload images for download by the user. Without this image upload will fail.</li>
<li>Packer as a build tool. Without this, the service cannot be redeployed.</li>
<li>TerraForm as a deployment orchestrator. Without this, the service cannot be redeployed.</li>
<li>Github as an upstream repository. Without this, the service cannot be redeployed.</li>
<li>Gitlab, AWS EC2, and Openstack for upstream testing. Without this changes to the service cannot land.</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="service-diagram">Service Diagram<a href="#service-diagram" class="hash-link" aria-label="Direct link to Service Diagram" title="Direct link to Service Diagram">​</a></h2>
<p>See parent page.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="application-success-criteria">Application Success Criteria<a href="#application-success-criteria" class="hash-link" aria-label="Direct link to Application Success Criteria" title="Direct link to Application Success Criteria">​</a></h2>
<p>The worker fleet is successful if:</p>
<ol>
<li>It scales on demand to avoid pending jobs having overly long queue times.</li>
<li>The jobs are executed in a timely fashion.</li>
<li>The job error rate (including image builds and uploads) is low.</li>
</ol>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="state">State<a href="#state" class="hash-link" aria-label="Direct link to State" title="Direct link to State">​</a></h2>
<p>Workers only have ephemeral state.</p>
<p>To optimize build-times, workers will keep a cache of previously (partially) built or downloaded
artifacts if this is lost it will be recreated on demand with no other loss than extra running time.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="load-testing">Load Testing<a href="#load-testing" class="hash-link" aria-label="Direct link to Load Testing" title="Direct link to Load Testing">​</a></h2>
<p>Image Builder is currently being load tested on a weekly basis with failure thresholds reflecting the
SLIs. The load tests happen against stage CRC. An example can be found
<a href="https://gitlab.com/osbuild/ci/image-builder/-/jobs/1541382293" target="_blank" rel="noopener noreferrer">here</a>.</p>
<p>The load testing happens against stage, and tests the entire stack, including the workers.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="capacity">Capacity<a href="#capacity" class="hash-link" aria-label="Direct link to Capacity" title="Direct link to Capacity">​</a></h2>
<p>Increasing the rate at which workers can handle jobs is easily done by scaling up the ASG.</p>
<p>The workers are also limited by a 2 week image retention period in our cloud accounts. For GCP
images this means there&#x27;s can have a maximum of 1000 images stored at any given time. For AWS it&#x27;s
limited by the snapshots per region limit (100k). And it&#x27;s limited by the amount of images that can
concurrently be imported (20). The latter might pose a problem in future.</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class="col"><a href="https://github.com/osbuild/osbuild.github.io/tree/main/docs/hosted/architecture/03-image-builder-workers.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_JAkA"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/hosted/architecture/image-builder-composer/"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Image Builder Composer</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/hosted/fedora-console/"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Fedora service</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#service-description" class="table-of-contents__link toc-highlight">Service Description</a></li><li><a href="#technology-stack" class="table-of-contents__link toc-highlight">Technology Stack</a></li><li><a href="#components" class="table-of-contents__link toc-highlight">Components</a></li><li><a href="#routes" class="table-of-contents__link toc-highlight">Routes</a></li><li><a href="#dependencies" class="table-of-contents__link toc-highlight">Dependencies</a><ul><li><a href="#internal" class="table-of-contents__link toc-highlight">Internal</a></li><li><a href="#external" class="table-of-contents__link toc-highlight">External</a></li></ul></li><li><a href="#service-diagram" class="table-of-contents__link toc-highlight">Service Diagram</a></li><li><a href="#application-success-criteria" class="table-of-contents__link toc-highlight">Application Success Criteria</a></li><li><a href="#state" class="table-of-contents__link toc-highlight">State</a></li><li><a href="#load-testing" class="table-of-contents__link toc-highlight">Load Testing</a></li><li><a href="#capacity" class="table-of-contents__link toc-highlight">Capacity</a></li></ul></div></div></div></div></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/orgs/osbuild/discussions" target="_blank" rel="noopener noreferrer" class="footer__link-item">Discussions<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://matrix.to/#/#image-builder:fedoraproject.org" target="_blank" rel="noopener noreferrer" class="footer__link-item">Matrix<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/osbuild/" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://github.com/osbuild/osbuild.github.io/commits/8a3d1344d7a52a5ab9c893f3e5f9dba67e2d1c0d" target="_blank" rel="noopener noreferrer" class="footer__link-item">Changelog<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2025 Red Hat, Inc. Built with Docusaurus.</div></div></div></footer></div>
</body>
</html>