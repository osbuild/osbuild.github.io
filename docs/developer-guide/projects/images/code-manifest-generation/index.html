<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-developer-guide/projects/images/code-manifest-generation" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.4.0">
<title data-rh="true">Manifest generation | Image Builder</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://saurus.osbuild.org/docs/developer-guide/projects/images/code-manifest-generation"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Manifest generation | Image Builder"><meta data-rh="true" name="description" content="This document explains how manifests are generated in code. It is useful for"><meta data-rh="true" property="og:description" content="This document explains how manifests are generated in code. It is useful for"><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://saurus.osbuild.org/docs/developer-guide/projects/images/code-manifest-generation"><link data-rh="true" rel="alternate" href="https://saurus.osbuild.org/docs/developer-guide/projects/images/code-manifest-generation" hreflang="en"><link data-rh="true" rel="alternate" href="https://saurus.osbuild.org/docs/developer-guide/projects/images/code-manifest-generation" hreflang="x-default"><link rel="stylesheet" href="/assets/css/styles.001b8615.css">
<script src="/assets/js/runtime~main.77eeca3c.js" defer="defer"></script>
<script src="/assets/js/main.94c709c9.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard" data-theme="light">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const n=new URLSearchParams(window.location.search).entries();for(var[t,e]of n)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.svg" alt="osbuild logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/img/logo_dark.svg" alt="osbuild logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">Image Builder</b></a><a class="navbar__item navbar__link" href="/docs/hosted/architecture/">Hosted</a><a class="navbar__item navbar__link" href="/docs/on-premises/overview/">On Premises</a><a class="navbar__item navbar__link" href="/docs/bootc/">Bootc</a><a class="navbar__item navbar__link" href="/docs/user-guide/introduction">User Guide</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/developer-guide/index">Developer Guide</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/osbuild/" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"><div class="dsla-search-wrapper"><div class="dsla-search-field" data-tags="default,docs-default-current"></div></div></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/developer-guide/index">Developer Guide</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/developer-guide/general/">General</a><button aria-label="Expand sidebar category &#x27;General&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" href="/docs/developer-guide/projects/">Projects</a><button aria-label="Collapse sidebar category &#x27;Projects&#x27;" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/docs/developer-guide/projects/cockpit-composer/">Cockpit Composer</a><button aria-label="Expand sidebar category &#x27;Cockpit Composer&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/docs/developer-guide/projects/composer-cli/">composer-cli</a><button aria-label="Expand sidebar category &#x27;composer-cli&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/docs/developer-guide/projects/image-builder/">Image Builder</a><button aria-label="Expand sidebar category &#x27;Image Builder&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/developer-guide/projects/image-builder-frontend/">Image Builder Frontend</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" tabindex="0" href="/docs/developer-guide/projects/images/">Images</a><button aria-label="Collapse sidebar category &#x27;Images&#x27;" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/developer-guide/projects/images/cmds">cmds</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/developer-guide/projects/images/code-manifest-generation">Manifest generation</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/developer-guide/projects/images/developer">Hacking on osbuild/images</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/developer-guide/projects/images/testing">osbuild/images testing information</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/docs/developer-guide/projects/osbuild/">OSBuild</a><button aria-label="Expand sidebar category &#x27;OSBuild&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/docs/developer-guide/projects/osbuild-composer/">OSBuild Composer</a><button aria-label="Expand sidebar category &#x27;OSBuild Composer&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/developer-guide/projects/rpmrepo/">RPMrepo Snapshots</a></li></ul></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/docs/developer-guide/projects/"><span itemprop="name">Projects</span></a><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/docs/developer-guide/projects/images/"><span itemprop="name">Images</span></a><meta itemprop="position" content="2"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Manifest generation</span><meta itemprop="position" content="3"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><h1>Manifest generation</h1>
<p>This document explains how manifests are generated in code. It is useful for
understanding how (and where) changes should be made in the pipeline generation
code to have the desired effect.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="overview">Overview<a class="hash-link" aria-label="Direct link to Overview" title="Direct link to Overview" href="/docs/developer-guide/projects/images/code-manifest-generation#overview">​</a></h2>
<p>Manifests are generated in two general stages: <em>Instantiation</em> and <em>Serialization</em>.</p>
<ul>
<li>Instantiation: Creates an object that implements the
<a href="https://pkg.go.dev/github.com/osbuild/images@main/pkg/manifest#Manifest" target="_blank" rel="noopener noreferrer"><code>manifest.Manifest</code></a> interface.<!-- -->
<ul>
<li>Creating this requires a number of steps. See <a href="/docs/developer-guide/projects/images/code-manifest-generation#manifest-instantiation">Manifest
Instantiation</a>.</li>
<li>An instantiated <code>Manifest</code> contains:<!-- -->
<ul>
<li><strong>Source</strong> specifications for content: package names, containers, ostree
commits.</li>
<li>An array of <a href="https://pkg.go.dev/github.com/osbuild/images@main/pkg/manifest#Pipeline" target="_blank" rel="noopener noreferrer"><code>manifest.Pipeline</code></a> objects, each
with necessary customizations and serialization methods for producing
stage-sequences.</li>
</ul>
</li>
</ul>
</li>
<li>Serialization: Creates the sequence of stages based on each pipeline and
produces <a href="https://pkg.go.dev/github.com/osbuild/images@main/pkg/manifest#OSBuildManifest" target="_blank" rel="noopener noreferrer"><code>manifest.OSBuildManifest</code></a>, which
is a <code>[]byte</code> array with custom unmarshalling/marshalling methods.<!-- -->
<ul>
<li>This stage requires the content specifications resolved from the manifest
source specifications (package specs, container specs, ostree commit
specs). See <a href="/docs/developer-guide/projects/images/code-manifest-generation#resolving-content">Resolving Content</a>.</li>
</ul>
</li>
</ul>
<p>The <code>makeManifest()</code> function in <code>cmd/build/main.go</code> is a straightforward
implementation of the sequence of actions required to generate a manifest
described below.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="manifest-instantiation">Manifest Instantiation<a class="hash-link" aria-label="Direct link to Manifest Instantiation" title="Direct link to Manifest Instantiation" href="/docs/developer-guide/projects/images/code-manifest-generation#manifest-instantiation">​</a></h2>
<p>Instantiating a manifest involves generating an array of
<a href="https://pkg.go.dev/github.com/osbuild/images@main/pkg/manifest#Pipeline" target="_blank" rel="noopener noreferrer">Pipelines</a> that will produce an image. Each pipeline
supports different options that will affect the stages and stage options it
will generate.</p>
<p>Typically, manifest instantiation happens inside the
<a href="https://pkg.go.dev/github.com/osbuild/images@main/pkg/distro/ImageType" target="_blank" rel="noopener noreferrer"><code>ImageType.Manifest()</code></a> function, which each distro
implements separately. The function is responsible for:</p>
<ul>
<li>Validating blueprint customizations for the selected image type.</li>
<li>Collecting static package sets for the distro and image type.</li>
<li>Collecting container source specs from the blueprint customizations.</li>
<li>Calling the image function for the image type, which creates an
<a href="https://pkg.go.dev/github.com/osbuild/images@main/pkg/image#ImageKind" target="_blank" rel="noopener noreferrer"><code>image.ImageKind</code></a> object, and</li>
<li>Instantiating the manifest using <code>ImageKind.InstantiateManifest()</code>.</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="the-os-pipeline">The OS pipeline<a class="hash-link" aria-label="Direct link to The OS pipeline" title="Direct link to The OS pipeline" href="/docs/developer-guide/projects/images/code-manifest-generation#the-os-pipeline">​</a></h3>
<p>The <a href="https://pkg.go.dev/github.com/osbuild/images@main/pkg/manifest#OS" target="_blank" rel="noopener noreferrer">OS</a> pipeline is the biggest and most central
pipeline. It is responsible for generating the stages that will create the main
OS tree of the resulting image. Almost all customizations that control specific
options for a bootable image are defined on this pipeline.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="the-build-pipeline">The Build pipeline<a class="hash-link" aria-label="Direct link to The Build pipeline" title="Direct link to The Build pipeline" href="/docs/developer-guide/projects/images/code-manifest-generation#the-build-pipeline">​</a></h3>
<p>The <a href="https://pkg.go.dev/github.com/osbuild/images@main/pkg/manifest#Build" target="_blank" rel="noopener noreferrer">Build</a> pipeline is used in every manifest to define
a build root for all the following pipelines to run in. It is always added
first and is almost never customized beyond package selection.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="package-selection">Package Selection<a class="hash-link" aria-label="Direct link to Package Selection" title="Direct link to Package Selection" href="/docs/developer-guide/projects/images/code-manifest-generation#package-selection">​</a></h3>
<p>The OS pipeline&#x27;s private <code>getPackageSetChains()</code> method (which is called by
<a href="https://pkg.go.dev/github.com/osbuild/images@main/pkg/manifest#Manifest.GetPackageSetChains" target="_blank" rel="noopener noreferrer"><code>Manifest.GetPackageSetChains()</code></a>)
is a good example of dynamic package selection based on enabled features and
customizations. Packages are selected based on features that will be required
on the running system. For example, if NTP servers are defined for the image,
the <code>chrony</code> package is selected.</p>
<p>The build pipeline is special in that extra packages are added to it
dynamically based on the requirements of subsequent pipelines. Pipelines can
define build packages that they require in the <code>getBuildPackages()</code> private
method. These packages will be merged with the static packages that are defined
for the build root. For example, if a container will be embedded in the OS
pipeline, the <code>skopeo</code> package is added to the build root to copy the container
into the OS container store.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="resolving-content">Resolving Content<a class="hash-link" aria-label="Direct link to Resolving Content" title="Direct link to Resolving Content" href="/docs/developer-guide/projects/images/code-manifest-generation#resolving-content">​</a></h2>
<p><a href="https://pkg.go.dev/github.com/osbuild/images@main/pkg/manifest#Manifest" target="_blank" rel="noopener noreferrer"><code>Manifest</code></a> objects should provide source
specifications for the content they need. Each <strong>source specification</strong> should be
resolved to a <strong>content specification</strong> and passed to the serialization function to
create the final manifest</p>
<p>All source and content specifications have type <code>map[string][]&lt;spec&gt;</code> (where
<code>&lt;spec&gt;</code> is the base type for the source or content specification). The map key
is the name of the pipeline that requires the content and multiple specs can be
assigned to each pipeline.</p>
<p>Currently there are three methods for three types of content that needs to be
resolved.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="package-sets">Package sets<a class="hash-link" aria-label="Direct link to Package sets" title="Direct link to Package sets" href="/docs/developer-guide/projects/images/code-manifest-generation#package-sets">​</a></h3>
<p><strong>Source specification</strong>: The source specification for packages is the
<a href="https://pkg.go.dev/github.com/osbuild/images@main/pkg/rpmmd#PackageSet" target="_blank" rel="noopener noreferrer"><code>rpmmd.PackageSet</code></a>. Each package set defines a list of
package names to include, a list to exclude, and a set of RPM repositories to
use to resolve and retrieve the packages.</p>
<p><em>Note:</em> The package source specification is special in that it defines an array
of package <em>sets</em>, which means each element in the array specifies multiple
packages. We sometimes refer to this array as a <em>package set chain</em>. Chains of
package sets are depsolved in order as part of the same call to <code>dnf-json</code>. The
result of a depsolve of each package set in the chain is merged with the
subsequent set and the result is a single array of package specs.</p>
<p><strong>Content specification</strong>: The content specification for packages is the
<a href="https://pkg.go.dev/github.com/osbuild/images@main/pkg/rpmmd#PackageSpec" target="_blank" rel="noopener noreferrer"><code>rpmmd.PackageSpec</code></a>. Each package spec is a fully resolved
description of an RPM, with metadata, a checksum, and a URL from which to
retrieve the package.</p>
<p><strong>Resolving</strong>: Resolving <strong>package sets</strong> to <strong>package specs</strong> is done using
the <a href="https://pkg.go.dev/github.com/osbuild/images@main/internal/dnfjson#Solver.Depsolve" target="_blank" rel="noopener noreferrer"><code>dnfjson.Solver.Depsolve()</code></a> function. This
call resolves the dependencies of an array of package sets and returns all the
packages that were specified, their dependencies, and the metadata for each
package.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="containers">Containers<a class="hash-link" aria-label="Direct link to Containers" title="Direct link to Containers" href="/docs/developer-guide/projects/images/code-manifest-generation#containers">​</a></h3>
<p><strong>Source specification</strong>: The source specification for containers is the
<a href="https://pkg.go.dev/github.com/osbuild/images@main/pkg/container#SourceSpec" target="_blank" rel="noopener noreferrer"><code>container.SourceSpec</code></a>. The main component is the
<code>Source</code>, which is a full ref to a container in a registry.</p>
<p><strong>Content specification</strong>: The content specification for containers is the
<a href="https://pkg.go.dev/github.com/osbuild/images@main/pkg/container#Spec" target="_blank" rel="noopener noreferrer"><code>container.Spec</code></a>. Each container spec is a fully
resolved description of a container.</p>
<p><strong>Resolving</strong>: Resolving <strong>container source specs</strong> to <strong>container specs</strong> is
done using the <a href="https://pkg.go.dev/github.com/osbuild/images@main/pkg/container#Resolver" target="_blank" rel="noopener noreferrer"><code>container.Resolver</code></a> type. Container
source specs are added to the resolver with the
<a href="https://pkg.go.dev/github.com/osbuild/images@main/pkg/container#Resolver.Add" target="_blank" rel="noopener noreferrer"><code>Resolver.Add()</code></a> method and all results are
retrieved with the <a href="https://pkg.go.dev/github.com/osbuild/images@main/pkg/container#Resolver.Finish" target="_blank" rel="noopener noreferrer"><code>Resolver.Finish()</code></a>
method.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="ostree-commits">OSTree Commits<a class="hash-link" aria-label="Direct link to OSTree Commits" title="Direct link to OSTree Commits" href="/docs/developer-guide/projects/images/code-manifest-generation#ostree-commits">​</a></h3>
<p><strong>Source specification</strong>: The source specification for ostree commits is the
<a href="https://pkg.go.dev/github.com/osbuild/images@main/pkg/ostree#SourceSpec" target="_blank" rel="noopener noreferrer"><code>ostree.SourceSpec</code></a>. It contains a URL to an ostree
repository and a ref to resolve.</p>
<p><strong>Content specification</strong>: The content specification for ostree commits is the
<a href="https://pkg.go.dev/github.com/osbuild/images@main/pkg/ostree#CommitSpec" target="_blank" rel="noopener noreferrer"><code>ostree.CommitSpec</code></a>. Each ostree commit spec
contains the URL and ref from the source spec as well as the checksum of the
commit.</p>
<p><strong>Resolving</strong>: Resolving <strong>ostree source specs</strong> to <strong>ostree commit specs</strong> is
done using the <a href="https://pkg.go.dev/github.com/osbuild/images@main/pkg/ostree#Resolve" target="_blank" rel="noopener noreferrer"><code>ostree.Resolve</code></a> function. Resolving an
ostree source spec mainly involves resolving the content of the file at
<code>&lt;URL&gt;/refs/heads/&lt;REF&gt;</code>.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="manifest-serialization">Manifest Serialization<a class="hash-link" aria-label="Direct link to Manifest Serialization" title="Direct link to Manifest Serialization" href="/docs/developer-guide/projects/images/code-manifest-generation#manifest-serialization">​</a></h2>
<p>When a manifest is serialized by calling its
<a href="https://pkg.go.dev/github.com/osbuild/images@main/pkg/manifest#Manifest.Serialize" target="_blank" rel="noopener noreferrer"><code>Manifest.Serialize()</code></a>, it runs the
private <code>serialize()</code> method on each pipeline in its array. Each pipeline in
turn creates an array of stages with the appropriate options based on the
customizations and options set on the pipeline.</p>
<p>The final JSON representation of the manifest that can be used with osbuild can
be created by using the standard library <a href="https://pkg.go.dev/encoding/json#Marshal" target="_blank" rel="noopener noreferrer"><code>json.Marshal()</code></a>
function.</p>
<hr></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class="col"><a href="https://github.com/osbuild/saurus/tree/main/docs/developer-guide/02-projects/images/code-manifest-generation.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_JAkA"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/developer-guide/projects/images/cmds"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">cmds</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/developer-guide/projects/images/developer"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Hacking on osbuild/images</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a class="table-of-contents__link toc-highlight" href="/docs/developer-guide/projects/images/code-manifest-generation#overview">Overview</a></li><li><a class="table-of-contents__link toc-highlight" href="/docs/developer-guide/projects/images/code-manifest-generation#manifest-instantiation">Manifest Instantiation</a><ul><li><a class="table-of-contents__link toc-highlight" href="/docs/developer-guide/projects/images/code-manifest-generation#the-os-pipeline">The OS pipeline</a></li><li><a class="table-of-contents__link toc-highlight" href="/docs/developer-guide/projects/images/code-manifest-generation#the-build-pipeline">The Build pipeline</a></li><li><a class="table-of-contents__link toc-highlight" href="/docs/developer-guide/projects/images/code-manifest-generation#package-selection">Package Selection</a></li></ul></li><li><a class="table-of-contents__link toc-highlight" href="/docs/developer-guide/projects/images/code-manifest-generation#resolving-content">Resolving Content</a><ul><li><a class="table-of-contents__link toc-highlight" href="/docs/developer-guide/projects/images/code-manifest-generation#package-sets">Package sets</a></li><li><a class="table-of-contents__link toc-highlight" href="/docs/developer-guide/projects/images/code-manifest-generation#containers">Containers</a></li><li><a class="table-of-contents__link toc-highlight" href="/docs/developer-guide/projects/images/code-manifest-generation#ostree-commits">OSTree Commits</a></li></ul></li><li><a class="table-of-contents__link toc-highlight" href="/docs/developer-guide/projects/images/code-manifest-generation#manifest-serialization">Manifest Serialization</a></li></ul></div></div></div></div></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://matrix.to/#/#image-builder:fedoraproject.org" target="_blank" rel="noopener noreferrer" class="footer__link-item">Matrix<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/osbuild/" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2024 Red Hat, Inc. Built with Docusaurus.</div></div></div></footer></div>
</body>
</html>