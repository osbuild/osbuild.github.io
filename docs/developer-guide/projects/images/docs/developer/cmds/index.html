<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-developer-guide/projects/images/docs/developer/cmds" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.6.3">
<title data-rh="true">cmds | Image Builder</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://osbuild.org/docs/developer-guide/projects/images/docs/developer/cmds/"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="cmds | Image Builder"><meta data-rh="true" name="description" content="Useful cmds"><meta data-rh="true" property="og:description" content="Useful cmds"><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://osbuild.org/docs/developer-guide/projects/images/docs/developer/cmds/"><link data-rh="true" rel="alternate" href="https://osbuild.org/docs/developer-guide/projects/images/docs/developer/cmds/" hreflang="en"><link data-rh="true" rel="alternate" href="https://osbuild.org/docs/developer-guide/projects/images/docs/developer/cmds/" hreflang="x-default"><link rel="stylesheet" href="/assets/css/styles.2d858f81.css">
<script src="/assets/js/runtime~main.ddbdc283.js" defer="defer"></script>
<script src="/assets/js/main.b86da844.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard" data-theme="light">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const n=new URLSearchParams(window.location.search).entries();for(var[t,e]of n)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.svg" alt="osbuild logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/img/logo_dark.svg" alt="osbuild logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">Image Builder</b></a><a class="navbar__item navbar__link" href="/docs/hosted/architecture/">Hosted</a><a class="navbar__item navbar__link" href="/docs/on-premises/overview/">On Premises</a><a class="navbar__item navbar__link" href="/docs/bootc/">Bootc</a><a class="navbar__item navbar__link" href="/docs/user-guide/introduction/">User Guide</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/developer-guide/index/">Developer Guide</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/osbuild/" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite" aria-pressed="false"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"><div class="dsla-search-wrapper"><div class="dsla-search-field" data-tags="default,docs-default-current"></div></div></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/developer-guide/index/">Developer Guide</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/developer-guide/general/">General Topics</a><button aria-label="Expand sidebar category &#x27;General Topics&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" href="/docs/developer-guide/projects/">Project Overview</a><button aria-label="Collapse sidebar category &#x27;Project Overview&#x27;" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/docs/developer-guide/projects/composer-cli/">composer-cli</a><button aria-label="Expand sidebar category &#x27;composer-cli&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/docs/developer-guide/projects/image-builder/">image-builder</a><button aria-label="Expand sidebar category &#x27;image-builder&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/docs/developer-guide/projects/image-builder-crc/">Image Builder console.redhat.com Middleware</a><button aria-label="Expand sidebar category &#x27;Image Builder console.redhat.com Middleware&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/developer-guide/projects/image-builder-frontend/">Image Builder Frontend</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" tabindex="0" href="/docs/developer-guide/projects/images/">Images</a><button aria-label="Collapse sidebar category &#x27;Images&#x27;" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" role="button" aria-expanded="true" tabindex="0" href="/docs/developer-guide/projects/images/docs/developer/">docs</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-4 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" tabindex="0" href="/docs/developer-guide/projects/images/docs/developer/">Hacking on osbuild/images</a><button aria-label="Collapse sidebar category &#x27;Hacking on osbuild/images&#x27;" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-5 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/developer-guide/projects/images/docs/developer/cmds/">cmds</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-5 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/developer-guide/projects/images/docs/developer/code-manifest-generation/">Manifest generation</a></li></ul></li></ul></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/developer-guide/projects/images/test/">osbuild/images testing information</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/docs/developer-guide/projects/koji-image-builder/">koji-image-builder</a><button aria-label="Expand sidebar category &#x27;koji-image-builder&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/docs/developer-guide/projects/osbuild/">OSBuild</a><button aria-label="Expand sidebar category &#x27;OSBuild&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/docs/developer-guide/projects/osbuild-composer/">OSBuild Composer</a><button aria-label="Expand sidebar category &#x27;OSBuild Composer&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/developer-guide/projects/rpmrepo/">RPMrepo Snapshots</a></li></ul></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/docs/developer-guide/projects/"><span itemprop="name">Project Overview</span></a><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/docs/developer-guide/projects/images/"><span itemprop="name">Images</span></a><meta itemprop="position" content="2"></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">docs</span><meta itemprop="position" content="3"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/docs/developer-guide/projects/images/docs/developer/"><span itemprop="name">Hacking on osbuild/images</span></a><meta itemprop="position" content="4"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">cmds</span><meta itemprop="position" content="5"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>cmds</h1></header><h3 class="anchor anchorWithStickyNavbar_LWe7" id="useful-cmds">Useful cmds<a href="#useful-cmds" class="hash-link" aria-label="Direct link to Useful cmds" title="Direct link to Useful cmds">​</a></h3>
<p>The following utilities, defined in the <code>cmd/</code> directory, are useful for
development and testing. They <strong>should not</strong> be relied on for production
purposes. In particular, command line options and default behavior can change
at any time.</p>
<p>The following are high level descriptions of what some of the utilities can do
and how they can be used during development. For specific flags and options,
refer to each command&#x27;s help output and doc strings.</p>
<p>Each utility can be compiled using <code>go build -o &lt;outputfile&gt; ./cmd/&lt;utility&gt;</code>
or run directly using <code>go run ./cmd/&lt;utility&gt;</code>. Use <code>go run ./cmd/&lt;utility&gt; -help</code> for option descriptions (e.g. <code>go run ./cmd/gen-manifests -help</code>).</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="manifest-generation">Manifest generation<a href="#manifest-generation" class="hash-link" aria-label="Direct link to Manifest generation" title="Direct link to Manifest generation">​</a></h4>
<p>The <code>gen-manifests</code> tool can be used to generate all or a subset of the
manifests for the images defined in the repository. This is useful for quickly
seeing the effects of changes in image definitions on the manifest and the
image build itself. While manifests are meant to be machine readable, it is
often much faster to inspect the difference between two manifests (before and
after a change in code) to evaluate if a change is having the desired effect.</p>
<p>Manifests can be generated with or without content resolution (e.g. package
depsolving, containers, ostree commits). If you are working on changes in image
definitions that do not rely on content (e.g. an image type&#x27;s partition table),
manifests without resolved content can be generated almost instantly. Note that
even though content is not resolved and packages are not depsolved, the
selected packages without their dependencies are still added to generated
manifests, so disabling package depsolving can also be used to inspect package
selection without dependencies.</p>
<p>Manifests should be generated with all content enabled if they are going to be
built. A common workflow when working on changing image definitions, or adding
a new image type, might be:</p>
<ol>
<li>Generate the manifests for the image types that you will be working on.</li>
<li>Make changes in an existing image definition or add a new image type.</li>
<li>Add appropriate configuration changes:<!-- -->
<ul>
<li>If a new image type is added, add it to the <a href="https://github.com/osbuild/images/tree/main/docs/developer/test/config-list.json" target="_blank" rel="noopener noreferrer">config
list</a> under an appropriate configuration file or
write a new one.</li>
<li>If an existing image type is being modified, and the change depends on an
image customization, make sure the modification is covered by an existing
<a href="https://github.com/osbuild/images/tree/main/docs/developer/test/configs" target="_blank" rel="noopener noreferrer">test config</a>.</li>
</ul>
</li>
<li>Generate the relevant manifests without content (<code>-packages=false -containers=false -commits=false</code>).<!-- -->
<ul>
<li>If the change depends on a customization, it might be more useful to
generate multiple manifests with different configuration options set and
inspect the differences between them.</li>
</ul>
</li>
<li>Inspect the differences between manifests generated in steps 1 and 4.</li>
<li>Generate manifest with all content enabled for the relevant image types.</li>
<li>Build at least one of the manifests using <code>osuild</code> and inspect the output
(boot the image or mount it to look for the desired changes).</li>
</ol>
<p><em>NOTE: By default, manifests created with the <code>gen-manifest</code> tool contain extra
metadata. The manifest itself is stored under the key &quot;manifest&quot;. You can
extract the actual manifest using <code>jq .manifest &lt;manifestfile&gt;.json</code>. Alternatively, you can generate manifests without
metadata using the <code>-metadata=false</code> option.</em></p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="diffing-manifests">Diffing manifests<a href="#diffing-manifests" class="hash-link" aria-label="Direct link to Diffing manifests" title="Direct link to Diffing manifests">​</a></h4>
<p>When working on image definitions it is often useful to see the effect
this has on existing manifests. The tool <code>gen-manifests-diff</code> will generate
a diff against the osbuild manifests produced by the current upstream &quot;main&quot;
branch of the &quot;images&quot; library. If a first argument is passed the diff
is generated against the given revision or git tag of upstream.</p>
<p>Note that no content is resolved, just like in step 4 of <a href="#manifest-generation">Manifest
generation</a> described above. This is done so that the
diff is small and fast. Because of this, the following should be noted:</p>
<ul>
<li>Repository changes are not caught. As long as the repository URLs and
configurations are the same between runs, the same exact manifest is
generated.</li>
<li>Upstream packaging dependency changes will not be caught. Similar to the
previous note, no changes in package versions or dependencies will occur if
the repository URLs and configurations don&#x27;t change.</li>
<li>Functionality that depends on package inclusion or package versions might not
behave as expected. This can have several side effects:<!-- -->
<ul>
<li>If a stage or stage option depends on a specific package being in the
image and that package is only added as a dependency, the manifest will
always be generated as if the package is not included. The alternative
functionality will never be visible in a manifest, unless the package is
added to an image type&#x27;s package list explicitly or is selected in the
blueprint.</li>
<li>If a stage or stage option depends on a specific package version, the
manifest will always be generated with the same behaviour (depending on
the mock package version generated for the unresolved manifest), so a
change in this behaviour between manifests or between commits will never
be visible.</li>
</ul>
</li>
<li>The same notes apply for containers and ostree commits. Remote changes in a
container registry or ostree repository will never be visible in manifests
with unresolved content unless the URLs and refs change.</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="building-images">Building images<a href="#building-images" class="hash-link" aria-label="Direct link to Building images" title="Direct link to Building images">​</a></h4>
<p>You can build an image by generating its manifest and then running
osbuild. Alternatively, the <code>cmd/build</code> tool can perform both steps in one
call. It will generate a manifest, build the image, and store both the image
and its manifest in the output directory.</p>
<p>The build tool must be run as root because image building with osbuild requires
superuser privileges. It is <strong>not recommended</strong> to run <code>sudo go run ./cmd/build</code> however. The <code>go run</code> command can make changes to the go build
cache and if these changes are made as root, it can cause issues when running
other go commands in the future as a regular user. Instead, it is recommended
to first build the binary and then run it as root:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">go build -o bin/build ./cmd/build</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sudo ./bin/build ...</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="booting-images">Booting images<a href="#booting-images" class="hash-link" aria-label="Direct link to Booting images" title="Direct link to Booting images">​</a></h4>
<p>You can boot an image in its target environment by using the appropriate
command from <code>cmd/</code>. <em>Currently, only AWS is supported.</em></p>
<p>For example, to boot an AMI or EC2 image, you can use the <code>./cmd/boot-aws</code>
command with the <code>setup</code> subcommand:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">go run ./cmd/boot-aws setup \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     --access-key-id &quot;${AWS_ACCESS_KEY_ID}&quot; \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     --secret-access-key &quot;${AWS_SECRET_ACCESS_KEY}&quot; \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     --region &quot;${AWS_REGION}&quot; \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     --bucket &quot;${AWS_BUCKET}&quot; \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     --ami-name &quot;${IMAGE_NAME}&quot; \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     --s3-key &quot;${IMAGE_KEY}&quot; \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     --username &quot;${USERNAME}&quot; \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     --arch &quot;${IMAGE_ARCHITECTURE}&quot; \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     --ssh-pubkey &quot;${PATH_TO_SSH_PUBLIC_KEY}&quot; \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     --ssh-privkey &quot;${PATH_TO_SSH_PRIVATE_KEY}&quot; \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     --resourcefile ./aws-test-resources.json \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     ${PATH_TO_IMAGE_FILE}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>where:</p>
<ul>
<li><code>${AWS_ACCESS_KEY_ID}</code> and <code>${AWS_SECRET_ACCESS_KEY}</code> are the AWS credentials,</li>
<li><code>${AWS_REGION}</code> is the AWS region to use,</li>
<li><code>${AWS_BUCKET}</code> is an S3 bucket (that must already exist),</li>
<li><code>${IMAGE_NAME}</code> is the name to use for registering the AMI,</li>
<li><code>${IMAGE_KEY}</code> is the key (filename) to use for the file in S3,</li>
<li><code>${USERNAME}</code> is the username to set up on the instance,</li>
<li><code>${IMAGE_ARCHITECTURE}</code> is the hardware architecture of the image being
uploaded and booted,</li>
<li><code>${PATH_TO_SSH_PUBLIC_KEY}</code> and <code>${PATH_TO_SSH_PRIVATE_KEY}</code> point to an
public/private SSH key pair.</li>
</ul>
<p>This command will upload the image to S3, register the image as an AMI, create
a security group configured to allow SSH access, and launch an instance from
the AMI. It will then wait until the instance is ready and print its public IP
address. It will also use the public ssh key and provided username to configure
cloud-init to create a user and set the ssh key on first boot.</p>
<p>The IDs of all created resources are stored in the file specified by the
<code>--resourcefile</code> flag. This can be used to tear down all the resources created
by the <code>setup</code> subcommand:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">go run ./cmd/boot-aws teardown \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     --access-key-id &quot;${AWS_ACCESS_KEY_ID}&quot; \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     --secret-access-key &quot;${AWS_SECRET_ACCESS_KEY}&quot; \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     --region &quot;${AWS_REGION}&quot; \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     --bucket &quot;${AWS_BUCKET}&quot; \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     --name &quot;${IMAGE_NAME}&quot; \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     --key &quot;${IMAGE_KEY}&quot; \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     --username &quot;${USERNAME}&quot; \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     --arch &quot;${IMAGE_ARCHITECTURE}&quot; \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     --ssh-pubkey &quot;${PATH_TO_SSH_PUBLIC_KEY}&quot; \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     --ssh-privkey &quot;${PATH_TO_SSH_PRIVATE_KEY}&quot; \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     --resourcefile ./aws-test-resources.json</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Alternatively, a setup-test-teardown procedure can be run in a single command using the <code>run</code> subcommand:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">go run ./cmd/boot-aws run \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     --access-key-id &quot;${AWS_ACCESS_KEY_ID}&quot; \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     --secret-access-key &quot;${AWS_SECRET_ACCESS_KEY}&quot; \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     --region &quot;${AWS_REGION}&quot; \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     --bucket &quot;${AWS_BUCKET}&quot; \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     --ami-name &quot;${IMAGE_NAME}&quot; \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     --s3-key &quot;${IMAGE_KEY}&quot; \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     --username &quot;${USERNAME}&quot; \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     --arch &quot;${IMAGE_ARCHITECTURE}&quot; \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     --ssh-pubkey &quot;${PATH_TO_SSH_PUBLIC_KEY}&quot; \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     --ssh-privkey &quot;${PATH_TO_SSH_PRIVATE_KEY}&quot; \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     ${PATH_TO_IMAGE_FILE} ${PATH_TO_SCRIPT}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>This will perform the same steps as the <code>setup</code> subcommand, then upload the
script specified by <code>${PATH_TO_SCRIPT}</code> to the instance, run it, and then
perform the same actions as the <code>teardown</code> subcommand.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="listing-available-image-type-configurations">Listing available image type configurations<a href="#listing-available-image-type-configurations" class="hash-link" aria-label="Direct link to Listing available image type configurations" title="Direct link to Listing available image type configurations">​</a></h4>
<p>The <code>cmd/list-images</code> utility simply lists all available combinations of
distribution, architecture, and image type. It also supports filtering one or
more of those three variables.</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class="col"><a href="https://github.com/osbuild/images/blob/main/docs/developer/cmds.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_JAkA"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/developer-guide/projects/images/docs/developer/"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Hacking on osbuild/images</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/developer-guide/projects/images/docs/developer/code-manifest-generation/"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Manifest generation</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#useful-cmds" class="table-of-contents__link toc-highlight">Useful cmds</a></li></ul></div></div></div></div></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/orgs/osbuild/discussions" target="_blank" rel="noopener noreferrer" class="footer__link-item">Discussions<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://matrix.to/#/#image-builder:fedoraproject.org" target="_blank" rel="noopener noreferrer" class="footer__link-item">Matrix<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/osbuild/" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://github.com/osbuild/osbuild.github.io/commits/9fdf94f8c4014bbcc1a558228878e2bf499bf22e" target="_blank" rel="noopener noreferrer" class="footer__link-item">Changelog<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2025 Red Hat, Inc. Built with Docusaurus.</div></div></div></footer></div>
</body>
</html>