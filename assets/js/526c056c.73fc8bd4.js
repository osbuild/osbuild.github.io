"use strict";(self.webpackChunksaurus=self.webpackChunksaurus||[]).push([[7164],{6467:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>a,contentTitle:()=>o,default:()=>h,frontMatter:()=>s,metadata:()=>d,toc:()=>l});var r=i(5893),t=i(1151);const s={},o="Building a RHEL for Edge Installer",d={id:"on-premises/commandline/edge-container+installer",title:"Building a RHEL for Edge Installer",description:'The following describes how to build a boot ISO which installs an OSTree-based system using the "RHEL for Edge Container" in combination with the "RHEL for Edge Installer" image types. The workflow has the same result as the Building OSTree Image guide with the new image types automating some of the steps.',source:"@site/docs/on-premises/02-commandline/edge-container+installer.md",sourceDirName:"on-premises/02-commandline",slug:"/on-premises/commandline/edge-container+installer",permalink:"/docs/on-premises/commandline/edge-container+installer",draft:!1,unlisted:!1,editUrl:"https://github.com/osbuild/saurus/tree/main/docs/on-premises/02-commandline/edge-container+installer.md",tags:[],version:"current",frontMatter:{},sidebar:"onPremises",previous:{title:"Building OSTree image",permalink:"/docs/on-premises/commandline/building-ostree-images"}},a={},l=[{value:"Process overview",id:"process-overview",level:2},{value:"Detailed workflow",id:"detailed-workflow",level:2},{value:"Build the container and serve the commit",id:"build-the-container-and-serve-the-commit",level:3},{value:"Build the installer",id:"build-the-installer",level:3}];function c(e){const n={a:"a",code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",li:"li",ol:"ol",p:"p",pre:"pre",ul:"ul",...(0,t.a)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.h1,{id:"building-a-rhel-for-edge-installer",children:"Building a RHEL for Edge Installer"}),"\n",(0,r.jsxs)(n.p,{children:['The following describes how to build a boot ISO which installs an OSTree-based system using the "RHEL for Edge Container" in combination with the "RHEL for Edge Installer" image types. The workflow has the same result as the ',(0,r.jsx)(n.a,{href:"/docs/on-premises/commandline/building-ostree-images",children:"Building OSTree Image"})," guide with the new image types automating some of the steps."]}),"\n",(0,r.jsx)(n.p,{children:"Note that there are some small differences in this procedure between RHEL 8.4 and RHEL 8.5:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["The names of the image types have changed. In 8.4, the image types were prefixed by ",(0,r.jsx)(n.code,{children:"rhel-"}),". This prefix was removed in 8.5.","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["The old names ",(0,r.jsx)(n.code,{children:"rhel-edge-container"})," and ",(0,r.jsx)(n.code,{children:"rhel-edge-installer"})," still work in RHEL 8.5 as aliases to the new names, however these names are considered deprecated and may be removed completely in future versions."]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.li,{children:"The internal port for the container has changed from 80 in RHEL 8.4 to 8080 in RHEL 8.5."}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"process-overview",children:"Process overview"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsx)(n.li,{children:"Create and load a blueprint with customizations."}),"\n",(0,r.jsxs)(n.li,{children:["Build an ",(0,r.jsx)(n.code,{children:"edge-container"})," (RHEL 8.5) or ",(0,r.jsx)(n.code,{children:"rhel-edge-container"})," (RHEL 8.4) image."]}),"\n",(0,r.jsx)(n.li,{children:"Load image in podman and start the container."}),"\n",(0,r.jsx)(n.li,{children:"Create and load an empty blueprint."}),"\n",(0,r.jsxs)(n.li,{children:["Build an ",(0,r.jsx)(n.code,{children:"edge-installer"})," (RHEL 8.5) or ",(0,r.jsx)(n.code,{children:"rhel-edge-installer"})," (RHEL 8.4) image, pointing the ",(0,r.jsx)(n.code,{children:"ostree-url"})," to ",(0,r.jsx)(n.code,{children:"http://10.0.2.2:8080/repo/"})," and setting the ",(0,r.jsx)(n.code,{children:"ostree-ref"})," to ",(0,r.jsx)(n.code,{children:"rhel/edge/demo"}),"."]}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:["The ",(0,r.jsx)(n.code,{children:"edge-container"})," image type creates an OSTree commit and embeds it into an OCI container with a web server. When the container is started, the web server serves the commit as an OSTree repository."]}),"\n",(0,r.jsxs)(n.p,{children:["The ",(0,r.jsx)(n.code,{children:"edge-intaller"})," image type pulls the commit from the running container and creates an installable boot ISO with a kickstart file configured to use the embedded OSTree commit."]}),"\n",(0,r.jsx)(n.h2,{id:"detailed-workflow",children:"Detailed workflow"}),"\n",(0,r.jsx)(n.h3,{id:"build-the-container-and-serve-the-commit",children:"Build the container and serve the commit"}),"\n",(0,r.jsxs)(n.p,{children:["Start by creating a blueprint for the commit. The content below is an example and can be modified to fit your needs. For this guide, we will name the file ",(0,r.jsx)(n.code,{children:"example.toml"}),"."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-toml",children:'name = "example"\ndescription = "RHEL for Edge Installer example"\nversion = "0.0.3"\n\n[[packages]]\nname = "vim-enhanced"\nversion = "*"\n\n[[packages]]\nname = "tmux"\nversion = "*"\n\n[customizations]\n\n[[customizations.user]]\nname = "user"\ndescription = "Example User"\npassword = "$6$uvdfeuHQYM6kUaea$fvvzyu.Z.u89TVCB2tq8UEc52XDFGnAqCo75BX3zu8OzIbS.EKMo/Saammb151sLrdzmlESnpNEPrJ7h5b0c6/"\ngroups = ["wheel"]\n'})}),"\n",(0,r.jsxs)(n.p,{children:["Now push the blueprint to osbuild-composer using ",(0,r.jsx)(n.code,{children:"composer-cli"}),":"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"$ composer-cli blueprints push example.toml\n"})}),"\n",(0,r.jsx)(n.p,{children:"And start the container build:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:'$ composer-cli compose start-ostree --ref "rhel/edge/example" example edge-container\nCompose 8e8014f8-4d15-441a-a26d-9ed7fc89e23a added to the queue\n'})}),"\n",(0,r.jsxs)(n.p,{children:["The value for ",(0,r.jsx)(n.code,{children:"--ref"})," can be changed but must begin with an alphanumeric character and contain only alphanumeric characters, ",(0,r.jsx)(n.code,{children:"/"}),", ",(0,r.jsx)(n.code,{children:"_"}),", ",(0,r.jsx)(n.code,{children:"-"}),", and ",(0,r.jsx)(n.code,{children:"."}),"."]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsxs)(n.em,{children:["Note: In RHEL 8.4, the image type was called ",(0,r.jsx)(n.code,{children:"rhel-edge-container"}),". It has been renamed to ",(0,r.jsx)(n.code,{children:"edge-container"})," in 8.5 onwards."]})}),"\n",(0,r.jsx)(n.p,{children:"Monitor the build status using:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"$ composer-cli compose status\n"})}),"\n",(0,r.jsx)(n.p,{children:"When the compose is FINISHED, download the result:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"$ composer-cli compose image 8e8014f8-4d15-441a-a26d-9ed7fc89e23a\n8e8014f8-4d15-441a-a26d-9ed7fc89e23a-rhel84-container.tar: 670.45 MB\n"})}),"\n",(0,r.jsx)(n.p,{children:"Load the container into registry:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"$ cat 8e8014f8-4d15-441a-a26d-9ed7fc89e23a-rhel84-container.tar | podman load\nGetting image source signatures\nCopying blob 82934cd3e69d done\nCopying config d11911c3dc done\nWriting manifest to image destination\nStoring signatures\nLoaded image(s): @d11911c3dc4bee46cabd52b91c87f48b8a7d450fadc8cfbeb69e2de98b413521\n"})}),"\n",(0,r.jsx)(n.p,{children:"Tag the image for convenience:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"$ podman tag d11911c3dc4bee46cabd52b91c87f48b8a7d450fadc8cfbeb69e2de98b413521 localhost/edge-example\n"})}),"\n",(0,r.jsx)(n.p,{children:"Start the container (note the different internal port numbers between the two versions)"}),"\n",(0,r.jsx)(n.p,{children:"For RHEL 8.4:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"$ podman run --rm -d -p 8080:80 --name ostree-repo localhost/edge-example\n"})}),"\n",(0,r.jsx)(n.p,{children:"For RHEL 8.5+:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"$ podman run --rm -d -p 8080:8080 --name ostree-repo localhost/edge-example\n"})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsxs)(n.em,{children:["Note: The ",(0,r.jsx)(n.code,{children:"-d"})," option detaches the container and leaves it running in the background. You can also remove the option to keep the container attached to the terminal."]})}),"\n",(0,r.jsx)(n.h3,{id:"build-the-installer",children:"Build the installer"}),"\n",(0,r.jsxs)(n.p,{children:["Start by creating a simple blueprint for the installer. The blueprint must not have any customizations or packages; only a name, and optionally a version and a description. Add the content below to a file and name it ",(0,r.jsx)(n.code,{children:"empty.toml"}),":"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:'name = "empty"\ndescription = "Empty blueprint"\nversion = "0.0.1"\n'})}),"\n",(0,r.jsxs)(n.p,{children:["The ",(0,r.jsx)(n.code,{children:"edge-installer"})," image type does not support customizations or package selection, so the build will fail if any are specified."]}),"\n",(0,r.jsx)(n.p,{children:"Push the blueprint:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"$ composer-cli blueprints push empty.toml\n"})}),"\n",(0,r.jsx)(n.p,{children:"Start the build:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:'$ composer-cli compose start-ostree --ref "rhel/edge/example" --url http://10.0.2.2:8080/repo/ empty edge-installer\nCompose 09d98a67-a401-4613-9a5b-b93f8a6e695f added to the queue\n'})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsxs)(n.em,{children:["Note: In RHEL 8.4, the image type was called ",(0,r.jsx)(n.code,{children:"rhel-edge-installer"}),". It has been renamed to ",(0,r.jsx)(n.code,{children:"edge-installer"})," in 8.5 onwards."]})}),"\n",(0,r.jsxs)(n.p,{children:["The ",(0,r.jsx)(n.code,{children:"--ref"})," argument must match the one from the ",(0,r.jsx)(n.code,{children:"rhel-edge-container"})," compose.\nThe ",(0,r.jsx)(n.code,{children:"--url"})," in this case is IP address of the container. This tutorial uses ",(0,r.jsx)(n.code,{children:"qemu"})," to boot the virtual machine and ",(0,r.jsx)(n.code,{children:"10.0.2.2"})," is an address which you can use to reach the host system from the guest: ",(0,r.jsx)(n.a,{href:"https://wiki.qemu.org/Documentation/Networking#User_Networking_.28SLIRP.29",children:"User Networking"}),"."]}),"\n",(0,r.jsx)(n.p,{children:"Monitor the build status using:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"$ composer-cli compose status\n"})}),"\n",(0,r.jsx)(n.p,{children:"When the compose is FINISHED, download the result:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"$ composer-cli compose image 09d98a67-a401-4613-9a5b-b93f8a6e695f\n 09d98a67-a401-4613-9a5b-b93f8a6e695f-rhel84-boot.iso: 1422.61 MB\n"})}),"\n",(0,r.jsx)(n.p,{children:'The downloaded image can then booted to begin the installation. If you used the blueprint in this guide, use the username "user" and password "password42" to login.'})]})}function h(e={}){const{wrapper:n}={...(0,t.a)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(c,{...e})}):c(e)}},1151:(e,n,i)=>{i.d(n,{Z:()=>d,a:()=>o});var r=i(7294);const t={},s=r.createContext(t);function o(e){const n=r.useContext(s);return r.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function d(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:o(e.components),r.createElement(s.Provider,{value:n},e.children)}}}]);