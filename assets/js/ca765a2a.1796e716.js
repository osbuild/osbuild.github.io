"use strict";(self.webpackChunksaurus=self.webpackChunksaurus||[]).push([[91573],{35517:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>d,contentTitle:()=>o,default:()=>h,frontMatter:()=>l,metadata:()=>s,toc:()=>a});const s=JSON.parse('{"id":"developer-guide/projects/image-builder-frontend/index","title":"Image Builder Frontend","description":"\x3c!--","source":"@site/docs/developer-guide/02-projects/image-builder-frontend/index.md","sourceDirName":"developer-guide/02-projects/image-builder-frontend","slug":"/developer-guide/projects/image-builder-frontend/","permalink":"/docs/developer-guide/projects/image-builder-frontend/","draft":false,"unlisted":false,"editUrl":"https://github.com/osbuild/image-builder-frontend/blob/main/README.md","tags":[],"version":"current","frontMatter":{"custom_edit_url":"https://github.com/osbuild/image-builder-frontend/blob/main/README.md"},"sidebar":"developer","previous":{"title":"Image Builder contributing guide","permalink":"/docs/developer-guide/projects/image-builder-crc/HACKING"},"next":{"title":"Images","permalink":"/docs/developer-guide/projects/images/"}}');var t=i(74848),r=i(28453);const l={custom_edit_url:"https://github.com/osbuild/image-builder-frontend/blob/main/README.md"},o="Image Builder Frontend",d={},a=[{value:"Project",id:"project",level:2},{value:"Principles",id:"principles",level:2},{value:"Table of Contents",id:"table-of-contents",level:2},{value:"How to build and run image-builder-frontend",id:"how-to-build-and-run-image-builder-frontend",level:2},{value:"Frontend Development",id:"frontend-development",level:3},{value:"Nodejs and npm version",id:"nodejs-and-npm-version",level:4},{value:"Webpack proxy",id:"webpack-proxy",level:4},{value:"Webpack proxy (staging) -- <em>Runs with image-builder&#39;s stage deployment</em>",id:"webpack-proxy-staging----runs-with-image-builders-stage-deployment",level:4},{value:"Image builder as Cockpit plugin",id:"image-builder-as-cockpit-plugin",level:3},{value:"Cockpit setup",id:"cockpit-setup",level:4},{value:"On-premises image builder installation and configuration",id:"on-premises-image-builder-installation-and-configuration",level:4},{value:"Scripts for local development of image builder plugin",id:"scripts-for-local-development-of-image-builder-plugin",level:4},{value:"Backend Development",id:"backend-development",level:3},{value:"API endpoints",id:"api-endpoints",level:2},{value:"Add a new API schema",id:"add-a-new-api-schema",level:3},{value:"Add a new endpoint",id:"add-a-new-endpoint",level:3},{value:"Unleash feature flags",id:"unleash-feature-flags",level:2},{value:"Mocking flags for tests",id:"mocking-flags-for-tests",level:3},{value:"Cleaning the flags",id:"cleaning-the-flags",level:3},{value:"File Structure",id:"file-structure",level:2},{value:"Quick Reference",id:"quick-reference",level:3},{value:"Style Guidelines",id:"style-guidelines",level:2},{value:"Test Guidelines",id:"test-guidelines",level:2},{value:"Running the tests",id:"running-the-tests",level:3},{value:"Running hosted service Playwright tests",id:"running-hosted-service-playwright-tests",level:2},{value:"Running tests",id:"running-tests",level:3},{value:"Dynamic vs static users",id:"dynamic-vs-static-users",level:3},{value:"Playwright Boot tests",id:"playwright-boot-tests",level:2},{value:"Local development setup",id:"local-development-setup",level:3},{value:"CI setup",id:"ci-setup",level:3},{value:"Automated run",id:"automated-run",level:4},{value:"Manual run",id:"manual-run",level:4},{value:"Where can I see results?",id:"where-can-i-see-results",level:4}];function c(e){const n={a:"a",blockquote:"blockquote",code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,r.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.header,{children:(0,t.jsx)(n.h1,{id:"image-builder-frontend",children:"Image Builder Frontend"})}),"\n",(0,t.jsx)(n.p,{children:"Frontend code for Image Builder."}),"\n",(0,t.jsx)(n.h2,{id:"project",children:"Project"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Website"}),": ",(0,t.jsx)(n.a,{href:"https://www.osbuild.org",children:"https://www.osbuild.org"})]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Bug Tracker"}),": ",(0,t.jsx)(n.a,{href:"https://github.com/osbuild/image-builder-frontend/issues",children:"https://github.com/osbuild/image-builder-frontend/issues"})]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Discussions"}),": ",(0,t.jsx)(n.a,{href:"https://github.com/orgs/osbuild/discussions",children:"https://github.com/orgs/osbuild/discussions"})]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Matrix"}),": #image-builder on ",(0,t.jsx)(n.a,{href:"https://matrix.to/#/#image-builder:fedoraproject.org",children:"fedoraproject.org"})]}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"principles",children:"Principles"}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsx)(n.li,{children:"We want to use the latest and greatest web technologies."}),"\n",(0,t.jsx)(n.li,{children:"We want to expose all the options and customizations possible, even if not all are visible by default."}),"\n",(0,t.jsx)(n.li,{children:"The default path should be \u2018short(est)\u2019 clickpath, which should be determined in a data-driven way."}),"\n",(0,t.jsxs)(n.li,{children:["This is an ",(0,t.jsx)(n.a,{href:"https://github.com/RedHatInsights/",children:"Insights application"}),", so it abides by some rules and standards of Insights."]}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"table-of-contents",children:"Table of Contents"}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.a,{href:"#frontend-development",children:"How to build and run image-builder-frontend"}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"#frontend-development",children:"Frontend Development"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"#image-builder-as-cockpit-plugin",children:"Image builder as Cockpit plugin"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"#backend-development",children:"Backend Development"})}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.a,{href:"#api-endpoints",children:"API endpoints"}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"#add-a-new-api-schema",children:"Add a new API schema"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"#add-a-new-endpoint",children:"Add a new endpoint"})}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.a,{href:"#unleash-feature-flags",children:"Unleash feature flags"}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"#mocking-flags-for-tests",children:"Mocking flags for tests"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"#cleaning-the-flags",children:"Cleaning the flags"})}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"#file-structure",children:"File Structure"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"#style-guidelines",children:"Style Guidelines"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"#test-guidelines",children:"Test Guidelines"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"#running-hosted-service-playwright-tests",children:"Running hosted service Playwright tests"})}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.a,{href:"#playwright-boot-tests",children:"Playwright Boot tests"}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"#local-development-setup",children:"Local development setup"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"#ci-setup",children:"CI setup"})}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"how-to-build-and-run-image-builder-frontend",children:"How to build and run image-builder-frontend"}),"\n",(0,t.jsxs)(n.blockquote,{children:["\n",(0,t.jsxs)(n.p,{children:["[!IMPORTANT]\nRunning image-builder-frontend against ",(0,t.jsx)(n.a,{href:"https://console.redhat.com/",children:"console.redhat.com"})," requires connection to the Red Hat VPN, which is only available to Red Hat employees. External contributors can locally run ",(0,t.jsx)(n.a,{href:"#image-builder-as-cockpit-plugin",children:"image builder as Cockpit plugin"}),"."]}),"\n",(0,t.jsxs)(n.p,{children:["As you will see in the following sections we ",(0,t.jsx)(n.strong,{children:"always"})," prefer ",(0,t.jsx)(n.code,{children:"npm clean-install"})," (aka ",(0,t.jsx)(n.code,{children:"npm ci"}),") over ",(0,t.jsx)(n.code,{children:"npm install"})," to install dependencies exactly as they are defined in the ",(0,t.jsx)(n.code,{children:"package-lock.json"})," file.",(0,t.jsx)("br",{}),"\nThis is crucial to avoid any discrepancies between the dependencies installed locally and the dependencies installed in the CI as well as unintentionally installing compromised dependencies."]}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"frontend-development",children:"Frontend Development"}),"\n",(0,t.jsx)(n.p,{children:"To develop the frontend you can use a proxy to run image-builder-frontend locally\nagainst the chrome and backend at console.redhat.com."}),"\n",(0,t.jsx)(n.p,{children:"Working against the production environment is preferred, as any work can be released without\nworrying if a feature from stage has been released yet."}),"\n",(0,t.jsx)(n.h4,{id:"nodejs-and-npm-version",children:"Nodejs and npm version"}),"\n",(0,t.jsxs)(n.p,{children:["Make sure you have npm@10 and node 22+ installed. If you need multiple versions of nodejs check out ",(0,t.jsx)(n.a,{href:"https://github.com/nvm-sh/nvm",children:"nvm"}),"."]}),"\n",(0,t.jsx)(n.h4,{id:"webpack-proxy",children:"Webpack proxy"}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsxs)(n.p,{children:["run ",(0,t.jsx)(n.code,{children:"npm clean-install"})]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsxs)(n.p,{children:["run ",(0,t.jsx)(n.code,{children:"npm run start:prod"})]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsxs)(n.p,{children:["redirect ",(0,t.jsx)(n.code,{children:"prod.foo.redhat.com"})," to localhost, if this has not been done already"]}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:'echo "127.0.0.1 prod.foo.redhat.com" >> /etc/hosts\n'})}),"\n",(0,t.jsxs)(n.ol,{start:"4",children:["\n",(0,t.jsxs)(n.li,{children:["open browser at ",(0,t.jsx)(n.code,{children:"https://prod.foo.redhat.com:1337/beta/insights/image-builder"})]}),"\n"]}),"\n",(0,t.jsxs)(n.h4,{id:"webpack-proxy-staging----runs-with-image-builders-stage-deployment",children:["Webpack proxy (staging) -- ",(0,t.jsx)(n.em,{children:"Runs with image-builder's stage deployment"})]}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsxs)(n.p,{children:["run ",(0,t.jsx)(n.code,{children:"npm clean-install"})]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsxs)(n.p,{children:["run ",(0,t.jsx)(n.code,{children:"npm run start:stage"})]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsxs)(n.p,{children:["redirect ",(0,t.jsx)(n.code,{children:"stage.foo.redhat.com"})," to localhost, if this has not been done already"]}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:'echo "127.0.0.1 stage.foo.redhat.com" >> /etc/hosts\n'})}),"\n",(0,t.jsxs)(n.ol,{start:"4",children:["\n",(0,t.jsxs)(n.li,{children:["open browser at ",(0,t.jsx)(n.code,{children:"https://stage.foo.redhat.com:1337/beta/insights/image-builder"})]}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"image-builder-as-cockpit-plugin",children:"Image builder as Cockpit plugin"}),"\n",(0,t.jsxs)(n.blockquote,{children:["\n",(0,t.jsxs)(n.p,{children:["[!NOTE]\nIssues marked with ",(0,t.jsx)(n.a,{href:"https://github.com/osbuild/image-builder-frontend/issues?q=is%3Aissue%20state%3Aopen%20label%3Acockpit-image-builder",children:"cockpit-image-builder"})," label are reproducible in image builder plugin and can be worked on by external contributors without connection to the Red Hat VPN."]}),"\n"]}),"\n",(0,t.jsx)(n.h4,{id:"cockpit-setup",children:"Cockpit setup"}),"\n",(0,t.jsxs)(n.p,{children:["To install and setup Cockpit follow guide at: ",(0,t.jsx)(n.a,{href:"https://cockpit-project.org/running.html",children:"https://cockpit-project.org/running.html"})]}),"\n",(0,t.jsx)(n.h4,{id:"on-premises-image-builder-installation-and-configuration",children:"On-premises image builder installation and configuration"}),"\n",(0,t.jsxs)(n.p,{children:["To install and configure ",(0,t.jsx)(n.code,{children:"osbuild-composer"})," on your local machine follow our documentation: ",(0,t.jsx)(n.a,{href:"https://osbuild.org/docs/on-premises/installation/",children:"https://osbuild.org/docs/on-premises/installation/"})]}),"\n",(0,t.jsx)(n.h4,{id:"scripts-for-local-development-of-image-builder-plugin",children:"Scripts for local development of image builder plugin"}),"\n",(0,t.jsx)(n.p,{children:"The following scripts are used to build the frontend with Webpack and install it into the Cockpit directories. These scripts streamline the development process by automating build and installation steps."}),"\n",(0,t.jsx)(n.p,{children:"Runs Webpack with the specified configuration (cockpit/webpack.config.ts) to build the frontend assets.\nUse this command whenever you need to compile the latest changes in your frontend code."}),"\n",(0,t.jsx)(n.p,{children:"Creates the necessary directory in the user's local Cockpit share (~/.local/share/cockpit/).\nCreates a symbolic link (image-builder-frontend) pointing to the built frontend assets (cockpit/public).\nUse this command after building the frontend to install it locally for development purposes.\nThe symbolic link allows Cockpit to serve the frontend assets from your local development environment,\nmaking it easier to test changes in real-time without deploying to a remote server."}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"make cockpit/build\n"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"make cockpit/devel-install\n"})}),"\n",(0,t.jsx)(n.p,{children:"To uninstall and remove the symbolic link, run the following command:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"make cockpit/devel-uninstall\n"})}),"\n",(0,t.jsx)(n.p,{children:"For convenience, you can run the following to combine all three steps:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"make cockpit/devel\n"})}),"\n",(0,t.jsx)(n.h3,{id:"backend-development",children:"Backend Development"}),"\n",(0,t.jsxs)(n.p,{children:["To develop both the frontend and the backend you can again use the proxy to run both the\nfrontend and backend locally against the chrome at cloud.redhat.com. For instructions\nsee the ",(0,t.jsx)(n.a,{href:"https://github.com/osbuild/osbuild-getting-started",children:"osbuild-getting-started project"}),"."]}),"\n",(0,t.jsx)(n.h2,{id:"api-endpoints",children:"API endpoints"}),"\n",(0,t.jsxs)(n.p,{children:["API slice definitions are programmatically generated using the ",(0,t.jsx)(n.a,{href:"https://redux-toolkit.js.org/rtk-query/usage/code-generation",children:"@rtk-query/codegen-openapi"})," package."]}),"\n",(0,t.jsxs)(n.p,{children:["The OpenAPI schema are imported during code generation. OpenAPI configuration files are\nstored in ",(0,t.jsx)(n.code,{children:"/api/config"}),". Each endpoint has a corresponding empty API slice and generated API\nslice which are stored in ",(0,t.jsx)(n.code,{children:"/src/store"}),"."]}),"\n",(0,t.jsx)(n.h3,{id:"add-a-new-api-schema",children:"Add a new API schema"}),"\n",(0,t.jsx)(n.p,{children:"For a hypothetical API called foobar"}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsxs)(n.li,{children:['Create a new "empty" API file under ',(0,t.jsx)(n.code,{children:"src/store/emptyFoobarApi.ts"})," that has following\ncontent:"]}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",children:"import { createApi, fetchBaseQuery } from '@reduxjs/toolkit/query/react';\n\nimport { FOOBAR_API } from '../constants';\n\n// initialize an empty api service that we'll inject endpoints into later as needed\nexport const emptyFoobarApi = createApi({\n  reducerPath: 'foobarApi',\n  baseQuery: fetchBaseQuery({ baseUrl: window.location.origin + FOO_BAR }),\n  endpoints: () => ({}),\n});\n"})}),"\n",(0,t.jsxs)(n.ol,{start:"2",children:["\n",(0,t.jsxs)(n.li,{children:["Declare new constant ",(0,t.jsx)(n.code,{children:"FOOBAR_API"})," with the API url in ",(0,t.jsx)(n.code,{children:"src/constants.ts"})]}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",children:"export const FOOBAR_API = 'api/foobar/v1'\n"})}),"\n",(0,t.jsxs)(n.ol,{start:"3",children:["\n",(0,t.jsxs)(n.li,{children:["Create the config file for code generation in ",(0,t.jsx)(n.code,{children:"api/config/foobar.ts"})," containing:"]}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",children:"import type { ConfigFile } from '@rtk-query/codegen-openapi';\n\nconst config: ConfigFile = {\n  schemaFile: 'URL_TO_THE_OPENAPI_SCHEMA',\n  apiFile: '../../src/store/emptyFoobarApi.ts',\n  apiImport: 'emptyContentSourcesApi',\n  outputFile: '../../src/store/foobarApi.ts',\n  exportName: 'foobarApi',\n  hooks: true,\n  filterEndpoints: ['getFoo', 'getBar', 'getFoobar'],\n};\n"})}),"\n",(0,t.jsxs)(n.ol,{start:"4",children:["\n",(0,t.jsxs)(n.li,{children:["Update the ",(0,t.jsx)(n.code,{children:"eslint.config.js"})," file by adding the generated code path to the ignores array:"]}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"ignores: [\n   <other ignored files>,\n  '**/foobarApi.ts',\n]\n"})}),"\n",(0,t.jsxs)(n.ol,{start:"5",children:["\n",(0,t.jsx)(n.li,{children:"run api generation"}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"npm run api\n"})}),"\n",(0,t.jsx)(n.p,{children:"And voil\xe0!"}),"\n",(0,t.jsx)(n.h3,{id:"add-a-new-endpoint",children:"Add a new endpoint"}),"\n",(0,t.jsxs)(n.p,{children:["To add a new endpoint, simply update the ",(0,t.jsx)(n.code,{children:"api/config/foobar.ts"})," file with new\nendpoints in the ",(0,t.jsx)(n.code,{children:"filterEndpoints"})," table."]}),"\n",(0,t.jsx)(n.h2,{id:"unleash-feature-flags",children:"Unleash feature flags"}),"\n",(0,t.jsxs)(n.p,{children:["Your user needs to have the corresponding rights, do the\nsame as this MR in internal gitlab ",(0,t.jsx)(n.a,{href:"https://gitlab.cee.redhat.com/service/app-interface/-/merge_requests/79225",children:"https://gitlab.cee.redhat.com/service/app-interface/-/merge_requests/79225"}),"\nyou can ask on the slack channel ",(0,t.jsx)(n.a,{href:"https://redhat-internal.slack.com/archives/C023YSA47A4",children:"https://redhat-internal.slack.com/archives/C023YSA47A4"})," for a merge if your MR stays unchecked for a little while."]}),"\n",(0,t.jsx)(n.p,{children:"Then connect to the following platforms:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.a,{href:"https://insights-stage.unleash.devshift.net/",children:"https://insights-stage.unleash.devshift.net/"})," for stage"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.a,{href:"https://insights.unleash.devshift.net",children:"https://insights.unleash.devshift.net"})," prod"]}),"\n"]}),"\n",(0,t.jsxs)(n.p,{children:["Once you have a toggle to work with, on the frontend code there's just need to\nimport the ",(0,t.jsx)(n.code,{children:"useFlag"})," hook and to use it. You can get some inspiration from\nexisting flags:"]}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.a,{href:"https://github.com/RedHatInsights/image-builder-frontend/blob/c84b493eba82ce83a7844943943d91112ffe8322/src/Components/ImagesTable/ImageLink.js#L99",children:"https://github.com/RedHatInsights/image-builder-frontend/blob/c84b493eba82ce83a7844943943d91112ffe8322/src/Components/ImagesTable/ImageLink.js#L99"})}),"\n",(0,t.jsx)(n.h3,{id:"mocking-flags-for-tests",children:"Mocking flags for tests"}),"\n",(0,t.jsxs)(n.p,{children:["Flags can be mocked for the unit tests to access some feature. Checkout:\n",(0,t.jsx)(n.a,{href:"https://github.com/osbuild/image-builder-frontend/blob/9a464e416bc3769cfc8e23b62f1dd410eb0e0455/src/test/Components/CreateImageWizard/CreateImageWizard.test.tsx#L49",children:"https://github.com/osbuild/image-builder-frontend/blob/9a464e416bc3769cfc8e23b62f1dd410eb0e0455/src/test/Components/CreateImageWizard/CreateImageWizard.test.tsx#L49"})]}),"\n",(0,t.jsx)(n.p,{children:"If the two possible code path accessible via the toggles are defined in the code\nbase, then it's good practice to test the two of them. If not, only test what's\nactually owned by the frontend project."}),"\n",(0,t.jsx)(n.h3,{id:"cleaning-the-flags",children:"Cleaning the flags"}),"\n",(0,t.jsx)(n.p,{children:"Unleash toggles are expected to live for a limited amount of time, documentation\nspecify 40 days for a release, we should keep that in mind for each toggle\nwe're planning on using."}),"\n",(0,t.jsx)(n.h2,{id:"file-structure",children:"File Structure"}),"\n",(0,t.jsx)(n.h3,{id:"quick-reference",children:"Quick Reference"}),"\n",(0,t.jsxs)(n.table,{children:[(0,t.jsx)(n.thead,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.th,{children:"Directory"}),(0,t.jsx)(n.th,{children:"Description"})]})}),(0,t.jsxs)(n.tbody,{children:[(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.a,{href:"https://github.com/RedHatInsights/image-builder-frontend/tree/main/api",children:(0,t.jsx)(n.code,{children:"/api"})})}),(0,t.jsx)(n.td,{children:"API schema and config files"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.a,{href:"https://github.com/RedHatInsights/image-builder-frontend/tree/main/config",children:(0,t.jsx)(n.code,{children:"/config"})})}),(0,t.jsx)(n.td,{children:"webpack configuration"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.a,{href:"https://github.com/RedHatInsights/image-builder-frontend/tree/main/src",children:(0,t.jsx)(n.code,{children:"/src"})})}),(0,t.jsx)(n.td,{children:"source code"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.a,{href:"https://github.com/RedHatInsights/image-builder-frontend/tree/main/src/Components",children:(0,t.jsx)(n.code,{children:"/src/Components"})})}),(0,t.jsx)(n.td,{children:"source code split by individual components"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.a,{href:"https://github.com/RedHatInsights/image-builder-frontend/tree/main/src/test",children:(0,t.jsx)(n.code,{children:"/src/test"})})}),(0,t.jsx)(n.td,{children:"test utilities"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.a,{href:"https://github.com/RedHatInsights/image-builder-frontend/tree/main/src/test/mocks",children:(0,t.jsx)(n.code,{children:"/src/test/mocks"})})}),(0,t.jsx)(n.td,{children:"mock handlers and server config for MSW"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.a,{href:"https://github.com/RedHatInsights/image-builder-frontend/tree/main/src/store",children:(0,t.jsx)(n.code,{children:"/src/store"})})}),(0,t.jsx)(n.td,{children:"Redux store"})]})]})]}),"\n",(0,t.jsx)(n.h2,{id:"style-guidelines",children:"Style Guidelines"}),"\n",(0,t.jsx)(n.p,{children:"This project uses recommended rule sets rom several plugins:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.code,{children:"@eslint/js"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.code,{children:"typescript-eslint"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.code,{children:"eslint-plugin-react"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.code,{children:"eslint-plugin-react-hooks"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.code,{children:"eslint-plugin-react-redux"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.code,{children:"eslint-plugin-import"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.code,{children:"eslint-plugin-jsx-a11y"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.code,{children:"eslint-plugin-disable-autofix"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.code,{children:"eslint-plugin-jest-dom"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.code,{children:"eslint-plugin-testing-library"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.code,{children:"eslint-plugin-playwright"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.code,{children:"@redhat-cloud-services/eslint-config-redhat-cloud-services"})}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:"To run the linter, use:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"npm run lint\n"})}),"\n",(0,t.jsx)(n.p,{children:"Any errors that can be fixed automatically, can be corrected by running:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"npm run lint:js:fix\n"})}),"\n",(0,t.jsxs)(n.p,{children:["All the linting rules and configuration of ESLint can be found in ",(0,t.jsx)(n.a,{href:"https://github.com/RedHatInsights/image-builder-frontend/blob/main/eslint.config.js",children:(0,t.jsx)(n.code,{children:"eslint.config.js"})}),"."]}),"\n",(0,t.jsx)(n.h2,{id:"test-guidelines",children:"Test Guidelines"}),"\n",(0,t.jsxs)(n.p,{children:["This project is tested using the ",(0,t.jsx)(n.a,{href:"https://vitest.dev/guide/",children:"Vitest"})," framework, ",(0,t.jsx)(n.a,{href:"https://testing-library.com/docs/react-testing-library/intro",children:"React Testing Library"}),", and the ",(0,t.jsx)(n.a,{href:"https://mswjs.io/docs/",children:"Mock Service Worker"})," library."]}),"\n",(0,t.jsx)(n.p,{children:"All UI contributions must also include a new test or update an existing test in order to maintain code coverage."}),"\n",(0,t.jsx)(n.h3,{id:"running-the-tests",children:"Running the tests"}),"\n",(0,t.jsx)(n.p,{children:"To run the unit tests, the linter, and the code coverage check run:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"npm run test\n"})}),"\n",(0,t.jsx)(n.p,{children:"These tests will also be run in our CI when a PR is opened."}),"\n",(0,t.jsxs)(n.p,{children:["Note that ",(0,t.jsx)(n.code,{children:"testing-library"})," DOM printout is currently disabled for all tests by the following configuration in ",(0,t.jsx)(n.code,{children:"src/test/setup.ts"}),":"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",children:"configure({\n  getElementError: (message: string) => {\n    const error = new Error(message);\n    error.name = 'TestingLibraryElementError';\n    error.stack = '';\n    return error;\n  },\n});\n"})}),"\n",(0,t.jsxs)(n.p,{children:["If you'd like to see the stack printed out you can either temporarily disable the configuration or generate a ",(0,t.jsx)(n.a,{href:"https://testing-playground.com/",children:"Testing Playground"})," link by adding ",(0,t.jsx)(n.code,{children:"screen.logTestingPlaygroundURL()"})," to your test."]}),"\n",(0,t.jsx)(n.h2,{id:"running-hosted-service-playwright-tests",children:"Running hosted service Playwright tests"}),"\n",(0,t.jsxs)(n.p,{children:["Hosted service Playwright tests provide test coverage of UI components in our service hosted at ",(0,t.jsx)(n.a,{href:"https://console.redhat.com/",children:"console.redhat.com"})," (currently only in stage environment). We mainly use them to test the Wizard and other parts of the UI.\nThe tests are located in the ",(0,t.jsx)(n.a,{href:"https://github.com/osbuild/image-builder-frontend/tree/main/playwright/",children:"playwright/"})," directory and are identified by the ",(0,t.jsx)(n.code,{children:"*.spec.ts"})," file extension."]}),"\n",(0,t.jsx)(n.h3,{id:"running-tests",children:"Running tests"}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsxs)(n.p,{children:["Copy the ",(0,t.jsx)(n.a,{href:"https://github.com/osbuild/image-builder-frontend/tree/main/playwright_example.env",children:"example env file"})," content and create a file named ",(0,t.jsx)(n.code,{children:".env"})," in the root directory of the project. Paste the example file content into it.\nFor local development fill in the:"]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"BASE_URL"})," - ",(0,t.jsx)(n.code,{children:"https://stage.foo.redhat.com:1337"})," is required, which is already set in the example config"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"PLAYWRIGHT_USER"})," - your consoledot stage username"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"PLAYWRIGHT_PASSWORD"})," - your consoledot stage password"]}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsx)(n.p,{children:"Make sure Playwright is installed as a dev dependency"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"npm clean-install\n"})}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsx)(n.p,{children:"Download the Playwright browsers with"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"npx playwright install\n"})}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsx)(n.p,{children:"Start the local development stage server by running"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"npm run start:stage\n"})}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsx)(n.p,{children:"Now you have two options of how to run the tests:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["(Preferred) Use VS Code and the ",(0,t.jsx)(n.a,{href:"https://marketplace.visualstudio.com/items?itemName=ms-playwright.playwright",children:"Playwright Test module for VSCode"}),". But other editors do have similar plugins for ease of use, if so desired"]}),"\n",(0,t.jsxs)(n.li,{children:["Using terminal - ",(0,t.jsx)(n.code,{children:"npx playwright test"})," will run the playwright test suite. ",(0,t.jsx)(n.code,{children:"npx playwright test --headed"})," will run the suite in a vnc-like browser so you can watch it's interactions."]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"dynamic-vs-static-users",children:"Dynamic vs static users"}),"\n",(0,t.jsxs)(n.p,{children:["This applies to the ",(0,t.jsx)(n.strong,{children:"stage"})," environment only. By default we generate a new user for each CI run for the hosted tests, however there is an option to use static user as well. You can set credentials for said static user like this:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-.env",children:'PLAYWRIGHT_STATIC_USER="<your_static_user_username>"\nPLAYWRIGHT_STATIC_PASSWORD="<your_static_user_password>"\n'})}),"\n",(0,t.jsxs)(n.p,{children:["For local development purposes, you can use the same credentials as for ",(0,t.jsx)(n.code,{children:"PLAYWRIGHT_USER"})," and ",(0,t.jsx)(n.code,{children:"PLAYWRIGHT_PASSWORD"})," if you are using your stage account for those."]}),"\n",(0,t.jsx)(n.h2,{id:"playwright-boot-tests",children:"Playwright Boot tests"}),"\n",(0,t.jsx)(n.p,{children:"This section describes what Playwright Boot tests are, how they work and how to run them locally."}),"\n",(0,t.jsxs)(n.p,{children:["Boot tests provide end to end coverage for Image Builder and they are used to test mainly integrations with other services. Their main advantage is that they build an image, upload it and ",(0,t.jsx)(n.strong,{children:"launch it on RHOSP"})," (RedHat OpenStack Platform). This way we can test images and their customizations through remotely executed commands on an actual running VM booted from the image.\nBoot tests are located in the ",(0,t.jsx)(n.a,{href:"https://github.com/osbuild/image-builder-frontend/tree/main/playwright/BootTests",children:"playwright/BootTests"})," directory and are identified by the ",(0,t.jsx)(n.code,{children:"*.boot.ts"})," file extension."]}),"\n",(0,t.jsx)(n.h3,{id:"local-development-setup",children:"Local development setup"}),"\n",(0,t.jsxs)(n.p,{children:["In order to run the Boot tests locally, we need to set up few things first on top of what we did in the ",(0,t.jsx)(n.a,{href:"#running-hosted-service-playwright-tests",children:"Running hosted service Playwright tests"})," section."]}),"\n",(0,t.jsxs)(n.p,{children:["We need additional fields in the .env file, some of them are already set and don't need to be changed in the ",(0,t.jsx)(n.a,{href:"https://github.com/osbuild/image-builder-frontend/tree/main/playwright_example.env",children:"example env file"}),"), but some of them have to be set manually, specifically following:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-.env",children:'OS_APPLICATION_CREDENTIAL_ID=<your_id>\nOS_APPLICATION_CREDENTIAL_SECRET=<your_secret>\nOS_SSH_KEY_NAME="<name_of_your_ssh_key_entry_in_openstack>"\n'})}),"\n",(0,t.jsxs)(n.blockquote,{children:["\n",(0,t.jsx)(n.p,{children:"[!NOTE]\nThe OpenStack Client is required for boot tests to function properly."}),"\n"]}),"\n",(0,t.jsxs)(n.p,{children:["In order to be able to access RHOSP within the Boot tests, we need to generate credentials and create an entry with our public ssh key on the platform. Log into ",(0,t.jsx)(n.a,{href:"https://api.rhos-01.prod.psi.rdu2.redhat.com/",children:"RHOSP dashboard"})," using ",(0,t.jsx)(n.strong,{children:"Keystone credentials"})," and navigate to Identity -> Application Credentials. There you can create the credentials (you will get values for ",(0,t.jsx)(n.code,{children:"OS_APPLICATION_CREDENTIAL_ID"})," and ",(0,t.jsx)(n.code,{children:"OS_APPLICATION_CREDENTIAL_SECRET"}),"). In order to create an entry for your SSH key, navigate to Project -> Compute -> Keys and add your public key there."]}),"\n",(0,t.jsx)(n.p,{children:"By filling out these variables you should be able to run the Boot test locally successfully."}),"\n",(0,t.jsx)(n.h3,{id:"ci-setup",children:"CI setup"}),"\n",(0,t.jsx)(n.p,{children:"Boot tests run as a scheduled nightly Github Action with a custom runner in AWS Codebuild, but there is an option to run them manually on a PR as well."}),"\n",(0,t.jsx)(n.h4,{id:"automated-run",children:"Automated run"}),"\n",(0,t.jsxs)(n.p,{children:["Boot tests run automatically on PRs when they contain changes inside the ",(0,t.jsx)(n.a,{href:"https://github.com/osbuild/image-builder-frontend/tree/main/playwright/BootTests",children:"playwright/BootTests"})," directory."]}),"\n",(0,t.jsx)(n.h4,{id:"manual-run",children:"Manual run"}),"\n",(0,t.jsxs)(n.p,{children:["In order to run the Boot tests on a PR, you can open the ",(0,t.jsx)(n.code,{children:"Boot tests"})," workflow in Github Actions and type in the number of PR into a ",(0,t.jsx)(n.code,{children:"Pull Request number to run tests against"})," field. The action will then pull the code from a PR of that number and execute as usual."]}),"\n",(0,t.jsx)(n.h4,{id:"where-can-i-see-results",children:"Where can I see results?"}),"\n",(0,t.jsxs)(n.p,{children:["You can find artifacts and link to a Currents report directly in the workflow run detail, but Currents will also link the report back to the PR when the workflow finishes as a ",(0,t.jsx)(n.em,{children:"check"}),"."]})]})}function h(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(c,{...e})}):c(e)}},28453:(e,n,i)=>{i.d(n,{R:()=>l,x:()=>o});var s=i(96540);const t={},r=s.createContext(t);function l(e){const n=s.useContext(r);return s.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:l(e.components),s.createElement(r.Provider,{value:n},e.children)}}}]);