"use strict";(self.webpackChunksaurus=self.webpackChunksaurus||[]).push([[662],{3962:(e,o,n)=>{n.r(o),n.d(o,{assets:()=>c,contentTitle:()=>r,default:()=>u,frontMatter:()=>t,metadata:()=>a,toc:()=>d});var i=n(5893),s=n(1151);const t={},r="Uploading an image to AWS",a={id:"on-premises/user-guide/uploading-cloud-images/uploading-to-aws",title:"Uploading an image to AWS",description:"osbuild-composer provides the users with a convenient way to upload images directly to AWS right after the image is built. Before you can use this feature, you have to define vmimport IAM role in your AWS account. See VM Import/Export Requirements in AWS documentation.",source:"@site/docs/on-premises/03-user-guide/04-uploading-cloud-images/01-uploading-to-aws.md",sourceDirName:"on-premises/03-user-guide/04-uploading-cloud-images",slug:"/on-premises/user-guide/uploading-cloud-images/uploading-to-aws",permalink:"/docs/on-premises/user-guide/uploading-cloud-images/uploading-to-aws",draft:!1,unlisted:!1,editUrl:"https://github.com/osbuild/saurus/tree/main/docs/on-premises/03-user-guide/04-uploading-cloud-images/01-uploading-to-aws.md",tags:[],version:"current",sidebarPosition:1,frontMatter:{},sidebar:"onPremises",previous:{title:"Uploading cloud images",permalink:"/docs/on-premises/user-guide/uploading-cloud-images/"},next:{title:"Uploading an image to an AWS S3 Bucket",permalink:"/docs/on-premises/user-guide/uploading-cloud-images/uploading-to-aws-s3"}},c={},d=[{value:"General Syntax",id:"general-syntax",level:2}];function l(e){const o={a:"a",blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",li:"li",p:"p",pre:"pre",ul:"ul",...(0,s.a)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(o.h1,{id:"uploading-an-image-to-aws",children:"Uploading an image to AWS"}),"\n",(0,i.jsxs)(o.p,{children:[(0,i.jsx)(o.code,{children:"osbuild-composer"})," provides the users with a convenient way to upload images directly to AWS right after the image is built. Before you can use this feature, you have to define ",(0,i.jsx)(o.code,{children:"vmimport"})," IAM role in your AWS account. See ",(0,i.jsx)(o.a,{href:"https://docs.aws.amazon.com/vm-import/latest/userguide/vmie_prereqs.html#vmimport-role",children:"VM Import/Export Requirements"})," in AWS documentation."]}),"\n",(0,i.jsx)(o.p,{children:"Now, you are ready to upload your first image to AWS. Using a text editor of your choice, create a configuration file with the following content:"}),"\n",(0,i.jsx)(o.pre,{children:(0,i.jsx)(o.code,{className:"language-toml",children:'provider = "aws"\n\n[settings]\naccessKeyID = "AWS_ACCESS_KEY_ID"\nsecretAccessKey = "AWS_SECRET_ACCESS_KEY"\nbucket = "AWS_BUCKET"\nregion = "AWS_REGION"\nkey = "OBJECT_KEY"\n'})}),"\n",(0,i.jsx)(o.p,{children:"There are several considerations when filling values in this file:"}),"\n",(0,i.jsxs)(o.ul,{children:["\n",(0,i.jsxs)(o.li,{children:[(0,i.jsx)(o.code,{children:"AWS_BUCKET"})," must be in the ",(0,i.jsx)(o.code,{children:"AWS_REGION"})]}),"\n",(0,i.jsxs)(o.li,{children:[(0,i.jsx)(o.code,{children:"AWS_BUCKET"})," must be created in AWS prior to running the script"]}),"\n",(0,i.jsxs)(o.li,{children:["The ",(0,i.jsx)(o.code,{children:"vmimport"})," role must have read access to the ",(0,i.jsx)(o.code,{children:"AWS_BUCKET"})," please see this guide on how to do so:  ",(0,i.jsx)(o.a,{href:"https://www.msp360.com/resources/blog/how-to-configure-vmimport-role/",children:"How to create vmimport role"})]}),"\n",(0,i.jsxs)(o.li,{children:[(0,i.jsx)(o.code,{children:"OBJECT_KEY"})," is the name of an intermediate S3 object. It must not exist before the upload, and it will be deleted when the process is done."]}),"\n"]}),"\n",(0,i.jsxs)(o.blockquote,{children:["\n",(0,i.jsxs)(o.p,{children:["If your authentication method requires you to also specify a session token, you can put it in the ",(0,i.jsx)(o.code,{children:"settings"})," section of the configuration file in a field named ",(0,i.jsx)(o.code,{children:"sessionToken"}),"."]}),"\n"]}),"\n",(0,i.jsx)(o.p,{children:"Once everything is configured, you can trigger a compose as usual with additional image name and cloud provider profile:"}),"\n",(0,i.jsx)(o.h2,{id:"general-syntax",children:"General Syntax"}),"\n",(0,i.jsx)(o.pre,{children:(0,i.jsx)(o.code,{children:"$ sudo composer-cli compose start <image_name> ami IMAGE_KEY aws-config.toml\n"})}),"\n",(0,i.jsx)(o.p,{children:"where IMAGE_KEY will be the name of your new AMI, once it is uploaded to EC2."})]})}function u(e={}){const{wrapper:o}={...(0,s.a)(),...e.components};return o?(0,i.jsx)(o,{...e,children:(0,i.jsx)(l,{...e})}):l(e)}},1151:(e,o,n)=>{n.d(o,{Z:()=>a,a:()=>r});var i=n(7294);const s={},t=i.createContext(s);function r(e){const o=i.useContext(t);return i.useMemo((function(){return"function"==typeof e?e(o):{...o,...e}}),[o,e])}function a(e){let o;return o=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:r(e.components),i.createElement(t.Provider,{value:o},e.children)}}}]);